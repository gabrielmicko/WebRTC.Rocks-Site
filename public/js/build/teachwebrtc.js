!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.teachwebrtc=t():e.teachwebrtc=t()}(window,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r(r.s=23)}([function(e,t,r){"use strict";var n=!0,a=!0;function i(e,t,r){var n=e.match(t);return n&&n.length>=r&&parseInt(n[r],10)}e.exports={extractVersion:i,wrapPeerConnectionEvent:function(e,t,r){if(e.RTCPeerConnection){var n=e.RTCPeerConnection.prototype,a=n.addEventListener;n.addEventListener=function(e,n){if(e!==t)return a.apply(this,arguments);var i=function(e){n(r(e))};return this._eventMap=this._eventMap||{},this._eventMap[n]=i,a.apply(this,[e,i])};var i=n.removeEventListener;n.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[r])return i.apply(this,arguments);var n=this._eventMap[r];return delete this._eventMap[r],i.apply(this,[e,n])},Object.defineProperty(n,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}},disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(n=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(a=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},log:function(){if("object"==typeof window){if(n)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},deprecated:function(e,t){a&&console.warn(e+" is deprecated, please use "+t+" instead.")},detectBrowser:function(e){var t=e&&e.navigator,r={browser:null,version:null};if(void 0===e||!e.navigator)return r.browser="Not a browser.",r;if(t.mozGetUserMedia)r.browser="firefox",r.version=i(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia)r.browser="chrome",r.version=i(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))r.browser="edge",r.version=i(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return r.browser="Not a supported browser.",r;r.browser="safari",r.version=i(t.userAgent,/AppleWebKit\/(\d+)\./,1)}return r}}},function(e,t,r){"use strict";r.r(t);var n=r(6),a=r.n(n),i=r(5),o=r.n(i),s=r(4),c=r.n(s);class d{constructor(e,t){this.tag=e+t,this.cookieKey="webrtcDebug"}log(e,t){this.l("log",e,t)}error(e,t){this.l("error",e,t)}l(e,t,r){let n="error"===e?console.error:console.debug,a=`[${this.tag}]: `;this.isDebug()&&(r?n(a+t,r):n(a+t))}isDebug(){return!!c.a.get(this.cookieKey)}}r.d(t,"default",function(){return u});const l={ONICECANDIDATE:"onicecandidate",ONTRACK:"ontrack",ONNEGOTIATIONNEEDED:"onnegotiationneeded",SIGNALINGSTATECHANGE:"signalingstatechange"},p={ONICECANDIDATE:"candidate",ONSTREAM:"stream",OFFER:"offer"};class u extends a.a{constructor(e={}){super(),this.options=e,this.options.type=this.options.type||"view",this.mediaStream=new MediaStream,this.pendingCandidatesQueue=[],this.debug=new d("WebRTC",this.options.debugTag),this._start()}_start(){let e=this._getPCConfiguration();this.pc=new RTCPeerConnection(e),this.debug.log("RTCPeerConnection created, configuration:",e),this._setListeners()}_createOffer(e){return new Promise((t,r)=>{this.debug.log("About the create an offer with the following constrains:",e),this.pc.createOffer(e).then(e=>{this.debug.log("Offer created:",e),this.pc.setLocalDescription(e).then(()=>{this.debug.log("Offer set as local description."),t(this.pc.localDescription.sdp)},()=>{this.debug.error("Failed to set offer as local description."),r()})},()=>{this.debug.error("Failed to create offer."),r()})})}_createAnswer(){return new Promise((e,t)=>{this.pc.createAnswer().then(r=>{this.debug.log("Answer created:",r),this.pc.setLocalDescription(r).then(()=>{this.debug.log("Answer set as local description."),e(this.pc.localDescription.sdp)},()=>{this.debug.error("Failed to set answer as local description."),t()})},()=>{this.debug.error("Failed to create answer."),t()})})}createOffer(){return this._createOffer(this._getOfferConfiguration())}createAnswer(){return this._createAnswer()}processOffer(e){return new Promise((t,r)=>{let n=new RTCSessionDescription({type:"offer",sdp:e});this.pc.setRemoteDescription(n).then(()=>{this.debug.log("Offer set as remote description.",n),t()},()=>{this.debug.error("Failed to set offer as remote description.",n),r()})})}processAnswer(e){return new Promise((t,r)=>{let n=new RTCSessionDescription({type:"answer",sdp:e});this.pc.setRemoteDescription(n).then(()=>{this.debug.log("Answer set as remote description.",n),t()},e=>{this.debug.error("Failed to set answer as remote description.",e),r()})})}addIceCandidate(e){return new Promise((t,r)=>{let n=new RTCIceCandidate(e);this._addIceCandidate(n).then(t,r)})}_addIceCandidate(e){return new Promise((t,r)=>{this.pc.addIceCandidate(e).then(()=>{this.debug.log("ICE candidate added.",e),t()},t=>{this.debug.error("ICE candidate could not be added.",e),r()})})}addStream(e){e.getTracks().forEach(t=>{this.pc.addTrack(t,e),this.debug.log("Track added to the peer connection.",t)})}_getPCConfiguration(){return this.options.rtcConfig||void 0}_getOfferConfiguration(){return"view"===this.options.type?{offerToReceiveAudio:!0,offerToReceiveVideo:!0}:{offerToReceiveAudio:!1,offerToReceiveVideo:!1}}destroy(){this.pc&&(this.pc.close(),this.debug.log("Destroying WebRTC, PeerConnection closed.")),this.debug.isDebug()&&this.webRTCAnalyzer.destroy()}_isMediaStreamReady(){let e=!1,t=!1;return this.mediaStream.getTracks().forEach(r=>{"audio"===r.kind&&(e=!0),"video"===r.kind&&(t=!0)}),!(!e||!t)}_setListeners(){this.pc[l.ONICECANDIDATE]=(e=>{e.candidate?(this.debug.log("ICE candidate generated.",e.candidate),this.emit(p.ONICECANDIDATE,e.candidate)):this.debug.log("Empty ICE candidate generated.",e)}),this.pc[l.ONTRACK]=(e=>{this.mediaStream.addTrack(e.track),this.debug.log("Track added to the media stream."),this._isMediaStreamReady()&&(this.debug.log("Stream is ready."),this.emit(p.ONSTREAM,this.mediaStream))}),this.debug.isDebug()&&(this.webRTCAnalyzer=new o.a({peerConnection:this.pc,interval:3e3}))}}},function(e,t,r){"use strict";r.r(t);var n=r(1);r(19);const a=new n.default({type:"publish",debugTag:"1",rtcConfig:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]}}),i=new n.default({type:"view",debugTag:"2",rtcConfig:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]}});function o(){return document.querySelector(".myvideo")}function s(){return document.querySelector(".yourvideo")}var c=function(e,t){$('main .tutorial [data-log="'+e+'"]').text(t)};r.d(t,"initStepByStep",function(){return l});const d={1:function(){try{var e=navigator.mediaDevices.getUserMedia({video:!0,audio:!0});e.then(function(e){try{o().srcObject=e,window.localStream=e,c("1","OK")}catch(e){console.log(e),c("1",e.name)}},function(){c("1","The getUserMedia promise was rejected.")}),e.catch(function(e){c("1",e.name)})}catch(e){console.log(e),c("1",e.name)}},2:function(){try{c("2","OK"),c("3","OK");var e=[];a.on("candidate",function(t){e.push(t),$(".mycandidate").html(""),c("5","Candidates "+e.length),$(".mycandidate").append(JSON.stringify(e))});var t=[];i.on("candidate",function(e){t.push(e),$(".yourcandidate").html(""),$(".yourcandidate").append(JSON.stringify(t))}),c("4","OK - RTCPeerConnection created.<br>"),i.on("stream",function(e){try{s().srcObject=e}catch(e){console.log(e)}}),c("6","Stream listener has been initiated!")}catch(e){console.log(e),c("4",e.name)}},3:function(){try{c("7","Stream has been added to local PeerConnection."),a.addStream(window.localStream)}catch(e){console.log(e),c("7",e.name)}},4:function(){try{c("8","Constraints have been initiated."),a.createOffer().then(e=>{c("9","Offer created, copy of Session Description appended."),c("10","Setting local description succeeded."),$(".mysdp").html(""),$(".mysdp").append(JSON.stringify(e))},function(e){c("8","Creation of the offer failed: "+e)})}catch(e){console.log(e),c("9",e.name)}},5:function(){try{alert("You should choose your own solution for signaling."),c("11","Signaling is not the part of the WebRTC Standard. I offer you to use WebSockets.")}catch(e){c("11",e)}},6:function(){try{var e=prompt("Please enter the offer SDP");"string"==typeof e&&e.length>1&&(c("12","Creating a sesson description from the offer SDP"),e=JSON.parse(e),window.localSDP=e)}catch(e){console.log(e),c("12",e)}},7:function(){try{i.processOffer(window.localSDP).then(function(){c("13","RemotDescription has been initiated.")},function(){c("13","Setting RemotDescription failed.")})}catch(e){console.log(e),c("13",e.message)}},8:function(){try{c("17","AnswerConstraints initiated."),i.createAnswer().then(function(e){c("18","Answer created. Copy of Session Description appended."),a.processAnswer(e),$(".yoursdp").html(""),$(".yoursdp").append(JSON.stringify(e))},function(e){c("18","Answer creation failed:"+e)})}catch(e){c("17",e.message)}},9:function(){try{c("19","Your Session Description has been set as a local description.")}catch(e){c("19",e.message)}},10:function(){try{alert("You should choose your own solution for signaling."),c("20","Signaling is not the part of the WebRTC Standard. I offer you to use WebSockets.")}catch(e){c("20",e.message)}},11:function(){try{var e=prompt("Please enter the answer SDP");"string"==typeof e&&e.length>1&&(c("21","Creating a sesson description from the offer SDP"),e=JSON.parse(e),window.remoteSDP=e),c("21","Creating a sesson description from the offer SDP")}catch(e){c("21",e.message)}},12:function(){try{"completed"===a.pc.iceConnectionState||"connected"===a.pc.iceConnectionState?c("22","Remote description on the local machine initialized."):a.processAnswer(window.remoteSDP).then(function(){c("22","Remote description on the local machine initialized.")},function(){c("22","Setting Remote description failed.")})}catch(e){c("22",e.message)}},13:function(){try{alert("You should choose your own solution for signaling."),c("14","Signaling is not the part of the WebRTC Standard. I offer you to use WebSockets.")}catch(e){c("14",e.message)}},15:function(){try{var e=prompt("Please enter the ICE candidate");"string"==typeof e&&e.length>0&&(JSON.parse(e).forEach(e=>{i.addIceCandidate(e)}),c("15","Creating RTC Ice Candidate."),c("16","Adding ICE Candidate to RTCPeerConnection"))}catch(e){console.log(e),c("15",e.message)}},17:function(){try{a.pc.onclose=function(){c("23","Local connection closed.")},i.pc.onclose=function(){c("24","Remote conenction closed.")},a.pc.close(),i.pc.close(),c("23","Connection closed."),c("24","Stream stopped."),o().pause(),s().pause()}catch(e){console.log(e),c("24",e.message)}}};function l(){$("main .tutorial .step .part").on("click",function(){$(this).parents(".step").toggleClass("open")}),$("main .tutorial .step .do-it").on("click",function(){var e=$(this);e.parents(".step").addClass("open"),function(e){d[e]()}(e.data("step"))})}},function(e,t,r){"use strict";var n={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};n.localCName=n.generateIdentifier(),n.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},n.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},n.getDescription=function(e){var t=n.splitSections(e);return t&&t[0]},n.getMediaSections=function(e){var t=n.splitSections(e);return t.shift(),t},n.matchPrefix=function(e,t){return n.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},n.parseCandidate=function(e){for(var t,r={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},n=8;n<t.length;n+=2)switch(t[n]){case"raddr":r.relatedAddress=t[n+1];break;case"rport":r.relatedPort=parseInt(t[n+1],10);break;case"tcptype":r.tcpType=t[n+1];break;case"ufrag":r.ufrag=t[n+1],r.usernameFragment=t[n+1];break;default:r[t[n]]=t[n+1]}return r},n.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},n.parseIceOptions=function(e){return e.substr(14).split(" ")},n.parseRtpMap=function(e){var t=e.substr(9).split(" "),r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=3===t.length?parseInt(t[2],10):1,r.numChannels=r.channels,r},n.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},n.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},n.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},n.parseFmtp=function(e){for(var t,r={},n=e.substr(e.indexOf(" ")+1).split(";"),a=0;a<n.length;a++)r[(t=n[a].trim().split("="))[0].trim()]=t[1];return r},n.writeFmtp=function(e){var t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var n=[];Object.keys(e.parameters).forEach(function(t){e.parameters[t]?n.push(t+"="+e.parameters[t]):n.push(t)}),t+="a=fmtp:"+r+" "+n.join(";")+"\r\n"}return t},n.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},n.writeRtcpFb=function(e){var t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},n.parseSsrcMedia=function(e){var t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},n=e.indexOf(":",t);return n>-1?(r.attribute=e.substr(t+1,n-t-1),r.value=e.substr(n+1)):r.attribute=e.substr(t+1),r},n.getMid=function(e){var t=n.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},n.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},n.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:n.matchPrefix(e+t,"a=fingerprint:").map(n.parseFingerprint)}},n.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),r},n.getIceParameters=function(e,t){var r=n.splitLines(e);return{usernameFragment:(r=r.concat(n.splitLines(t))).filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:r.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},n.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},n.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=n.splitLines(e)[0].split(" "),a=3;a<r.length;a++){var i=r[a],o=n.matchPrefix(e,"a=rtpmap:"+i+" ")[0];if(o){var s=n.parseRtpMap(o),c=n.matchPrefix(e,"a=fmtp:"+i+" ");switch(s.parameters=c.length?n.parseFmtp(c[0]):{},s.rtcpFeedback=n.matchPrefix(e,"a=rtcp-fb:"+i+" ").map(n.parseRtcpFb),t.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(s.name.toUpperCase())}}}return n.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(n.parseExtmap(e))}),t},n.writeRtpDescription=function(e,t){var r="";r+="m="+e+" ",r+=t.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){r+=n.writeRtpMap(e),r+=n.writeFmtp(e),r+=n.writeRtcpFb(e)});var a=0;return t.codecs.forEach(function(e){e.maxptime>a&&(a=e.maxptime)}),a>0&&(r+="a=maxptime:"+a+"\r\n"),r+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach(function(e){r+=n.writeExtmap(e)}),r},n.parseRtpEncodingParameters=function(e){var t,r=[],a=n.parseRtpParameters(e),i=-1!==a.fecMechanisms.indexOf("RED"),o=-1!==a.fecMechanisms.indexOf("ULPFEC"),s=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=s.length>0&&s[0].ssrc,d=n.matchPrefix(e,"a=ssrc-group:FID").map(function(e){return e.substr(17).split(" ").map(function(e){return parseInt(e,10)})});d.length>0&&d[0].length>1&&d[0][0]===c&&(t=d[0][1]),a.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var n={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(n.rtx={ssrc:t}),r.push(n),i&&((n=JSON.parse(JSON.stringify(n))).fec={ssrc:t,mechanism:o?"red+ulpfec":"red"},r.push(n))}}),0===r.length&&c&&r.push({ssrc:c});var l=n.matchPrefix(e,"b=");return l.length&&(l=0===l[0].indexOf("b=TIAS:")?parseInt(l[0].substr(7),10):0===l[0].indexOf("b=AS:")?1e3*parseInt(l[0].substr(5),10)*.95-16e3:void 0,r.forEach(function(e){e.maxBitrate=l})),r},n.parseRtcpParameters=function(e){var t={},r=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];r&&(t.cname=r.value,t.ssrc=r.ssrc);var a=n.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=a.length>0,t.compound=0===a.length;var i=n.matchPrefix(e,"a=rtcp-mux");return t.mux=i.length>0,t},n.parseMsid=function(e){var t,r=n.matchPrefix(e,"a=msid:");if(1===r.length)return{stream:(t=r[0].substr(7).split(" "))[0],track:t[1]};var a=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return a.length>0?{stream:(t=a[0].value.split(" "))[0],track:t[1]}:void 0},n.generateSessionId=function(){return Math.random().toString().substr(2,21)},n.writeSessionBoilerplate=function(e,t){var r=void 0!==t?t:2;return"v=0\r\no=thisisadapterortc "+(e||n.generateSessionId())+" "+r+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},n.writeMediaSection=function(e,t,r,a){var i=n.writeRtpDescription(e.kind,t);if(i+=n.writeIceParameters(e.iceGatherer.getLocalParameters()),i+=n.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":"active"),i+="a=mid:"+e.mid+"\r\n",e.direction?i+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?i+="a=sendrecv\r\n":e.rtpSender?i+="a=sendonly\r\n":e.rtpReceiver?i+="a=recvonly\r\n":i+="a=inactive\r\n",e.rtpSender){var o="msid:"+a.id+" "+e.rtpSender.track.id+"\r\n";i+="a="+o,i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+o,e.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+o,i+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+"\r\n"),i},n.getDirection=function(e,t){for(var r=n.splitLines(e),a=0;a<r.length;a++)switch(r[a]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[a].substr(2)}return t?n.getDirection(t):"sendrecv"},n.getKind=function(e){return n.splitLines(e)[0].split(" ")[0].substr(2)},n.isRejected=function(e){return"0"===e.split(" ",2)[1]},n.parseMLine=function(e){var t=n.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},n.parseOLine=function(e){var t=n.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},e.exports=n},function(e,t,r){var n,a;!function(i){void 0===(a="function"==typeof(n=i)?n.call(t,r,t,e):n)||(e.exports=a),e.exports=i()}(function(){function e(){for(var e=0,t={};e<arguments.length;e++){var r=arguments[e];for(var n in r)t[n]=r[n]}return t}return function t(r){function n(t,a,i){var o;if("undefined"!=typeof document){if(arguments.length>1){if("number"==typeof(i=e({path:"/"},n.defaults,i)).expires){var s=new Date;s.setMilliseconds(s.getMilliseconds()+864e5*i.expires),i.expires=s}i.expires=i.expires?i.expires.toUTCString():"";try{o=JSON.stringify(a),/^[\{\[]/.test(o)&&(a=o)}catch(e){}a=r.write?r.write(a,t):encodeURIComponent(String(a)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=(t=(t=encodeURIComponent(String(t))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape);var c="";for(var d in i)i[d]&&(c+="; "+d,!0!==i[d]&&(c+="="+i[d]));return document.cookie=t+"="+a+c}t||(o={});for(var l=document.cookie?document.cookie.split("; "):[],p=/(%[0-9A-Z]{2})+/g,u=0;u<l.length;u++){var m=l[u].split("="),f=m.slice(1).join("=");this.json||'"'!==f.charAt(0)||(f=f.slice(1,-1));try{var h=m[0].replace(p,decodeURIComponent);if(f=r.read?r.read(f,h):r(f,h)||f.replace(p,decodeURIComponent),this.json)try{f=JSON.parse(f)}catch(e){}if(t===h){o=f;break}t||(o[h]=f)}catch(e){}}return o}}return n.set=n,n.get=function(e){return n.call(n,e)},n.getJSON=function(){return n.apply({json:!0},[].slice.call(arguments))},n.defaults={},n.remove=function(t,r){n(t,"",e(r,{expires:-1}))},n.withConverter=t,n}(function(){})})},function(e,t,r){e.exports=r(20).default},function(e,t){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(e){return"function"==typeof e}function a(e){return"object"==typeof e&&null!==e}function i(e){return void 0===e}e.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,r,o,s,c,d;if(this._events||(this._events={}),"error"===e&&(!this._events.error||a(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}if(i(r=this._events[e]))return!1;if(n(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),r.apply(this,s)}else if(a(r))for(s=Array.prototype.slice.call(arguments,1),o=(d=r.slice()).length,c=0;c<o;c++)d[c].apply(this,s);return!0},r.prototype.addListener=function(e,t){var o;if(!n(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,n(t.listener)?t.listener:t),this._events[e]?a(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,a(this._events[e])&&!this._events[e].warned&&(o=i(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&o>0&&this._events[e].length>o&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){if(!n(t))throw TypeError("listener must be a function");var r=!1;function a(){this.removeListener(e,a),r||(r=!0,t.apply(this,arguments))}return a.listener=t,this.on(e,a),this},r.prototype.removeListener=function(e,t){var r,i,o,s;if(!n(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(o=(r=this._events[e]).length,i=-1,r===t||n(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(a(r)){for(s=o;s-- >0;)if(r[s]===t||r[s].listener&&r[s].listener===t){i=s;break}if(i<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n(r=this._events[e]))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){return this._events&&this._events[e]?n(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(n(t))return 1;if(t)return t.length}return 0},r.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,r){"use strict";var n=r(3),a=r(0);e.exports={shimRTCIceCandidate:function(e){if(e.RTCIceCandidate&&!(e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var r=new t(e),a=n.parseCandidate(e.candidate),i=Object.assign(r,a);return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,a.wrapPeerConnectionEvent(e,"icecandidate",function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t})}},shimCreateObjectURL:function(e){var t=e&&e.URL;if("object"==typeof e&&e.HTMLMediaElement&&"srcObject"in e.HTMLMediaElement.prototype&&t.createObjectURL&&t.revokeObjectURL){var r=t.createObjectURL.bind(t),n=t.revokeObjectURL.bind(t),i=new Map,o=0;t.createObjectURL=function(e){if("getTracks"in e){var t="polyblob:"+ ++o;return i.set(t,e),a.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),t}return r(e)},t.revokeObjectURL=function(e){n(e),i.delete(e)};var s=Object.getOwnPropertyDescriptor(e.HTMLMediaElement.prototype,"src");Object.defineProperty(e.HTMLMediaElement.prototype,"src",{get:function(){return s.get.apply(this)},set:function(e){return this.srcObject=i.get(e)||null,s.set.apply(this,[e])}});var c=e.HTMLMediaElement.prototype.setAttribute;e.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=i.get(arguments[1])||null),c.apply(this,arguments)}}},shimMaxMessageSize:function(e){if(!e.RTCSctpTransport&&e.RTCPeerConnection){var t=a.detectBrowser(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e,a,i,o;if(this._sctp=null,i=arguments[0],(o=n.splitSections(i.sdp)).shift(),o.some(function(e){var t=n.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})){var s,c=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var r=parseInt(t[1],10);return r!=r?-1:r}(arguments[0]),d=(e=c,a=65536,"firefox"===t.browser&&(a=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),a),l=function(e,r){var a=65536;"firefox"===t.browser&&57===t.version&&(a=65535);var i=n.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?a=parseInt(i[0].substr(19),10):"firefox"===t.browser&&-1!==r&&(a=2147483637),a}(arguments[0],c);s=0===d&&0===l?Number.POSITIVE_INFINITY:0===d||0===l?Math.max(d,l):Math.min(d,l);var p={};Object.defineProperty(p,"maxMessageSize",{get:function(){return s}}),this._sctp=p}return r.apply(this,arguments)}}},shimSendThrowTypeError:function(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return r(e,this),e},a.wrapPeerConnectionEvent(e,"datachannel",function(e){return r(e.channel,e.target),e})}function r(e,t){var r=e.send;e.send=function(){var n=arguments[0],a=n.length||n.size||n.byteLength;if("open"===e.readyState&&t.sctp&&a>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return r.apply(e,arguments)}}}}},function(e,t,r){"use strict";var n=r(0);e.exports={shimLocalStreamsAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getStreamById=function(e){var t=null;return this._localStreams&&this._localStreams.forEach(function(r){r.id===e&&(t=r)}),this._remoteStreams&&this._remoteStreams.forEach(function(r){r.id===e&&(t=r)}),t}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),-1===this._localStreams.indexOf(e)&&this._localStreams.push(e);var r=this;e.getTracks().forEach(function(n){t.call(r,n,e)})},e.RTCPeerConnection.prototype.addTrack=function(e,r){return r&&(this._localStreams?-1===this._localStreams.indexOf(r)&&this._localStreams.push(r):this._localStreams=[r]),t.call(this,e,r)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);var t=this._localStreams.indexOf(e);if(-1!==t){this._localStreams.splice(t,1);var r=this,n=e.getTracks();this.getSenders().forEach(function(e){-1!==n.indexOf(e.track)&&r.removeTrack(e)})}})}},shimRemoteStreamsAPI:function(e){"object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),"onaddstream"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach(function(e){if(t._remoteStreams||(t._remoteStreams=[]),!(t._remoteStreams.indexOf(e)>=0)){t._remoteStreams.push(e);var r=new Event("addstream");r.stream=e,t.dispatchEvent(r)}})})}}))},shimCallbacksAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,r=t.createOffer,n=t.createAnswer,a=t.setLocalDescription,i=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],a=r.apply(this,[n]);return t?(a.then(e,t),Promise.resolve()):a},t.createAnswer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],a=n.apply(this,[r]);return t?(a.then(e,t),Promise.resolve()):a};var s=function(e,t,r){var n=a.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n};t.setLocalDescription=s,s=function(e,t,r){var n=i.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.setRemoteDescription=s,s=function(e,t,r){var n=o.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.addIceCandidate=s}},shimGetUserMedia:function(e){var t=e&&e.navigator;t.getUserMedia||(t.webkitGetUserMedia?t.getUserMedia=t.webkitGetUserMedia.bind(t):t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,r,n){t.mediaDevices.getUserMedia(e).then(r,n)}.bind(t)))},shimRTCIceServerUrls:function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){for(var a=[],i=0;i<e.iceServers.length;i++){var o=e.iceServers[i];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(n.deprecated("RTCIceServer.url","RTCIceServer.urls"),(o=JSON.parse(JSON.stringify(o))).urls=o.url,delete o.url,a.push(o)):a.push(e.iceServers[i])}e.iceServers=a}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})},shimTrackEventTransceiver:function(e){"object"==typeof e&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){var r=this;if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var n=r.getTransceivers().find(function(e){return e.sender.track&&"audio"===e.sender.track.kind});!1===e.offerToReceiveAudio&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveAudio||n||r.addTransceiver("audio"),void 0!==e.offerToReceiveAudio&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var a=r.getTransceivers().find(function(e){return e.sender.track&&"video"===e.sender.track.kind});!1===e.offerToReceiveVideo&&a?"sendrecv"===a.direction?a.setDirection("sendonly"):"recvonly"===a.direction&&a.setDirection("inactive"):!0!==e.offerToReceiveVideo||a||r.addTransceiver("video")}return t.apply(r,arguments)}}}},function(e,t,r){"use strict";var n=r(0),a=n.log;e.exports=function(e){var t=n.detectBrowser(e),r=e&&e.navigator,i=e&&e.MediaStreamTrack,o=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},s=function(e,n,i){var s=function(e){if("object"!=typeof e||e.require)return e;var t=[];return Object.keys(e).forEach(function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var n=e[r]="object"==typeof e[r]?e[r]:{ideal:e[r]};if(void 0===n.min&&void 0===n.max&&void 0===n.exact||t.push(r),void 0!==n.exact&&("number"==typeof n.exact?n.min=n.max=n.exact:e[r]=n.exact,delete n.exact),void 0!==n.ideal){e.advanced=e.advanced||[];var a={};"number"==typeof n.ideal?a[r]={min:n.ideal,max:n.ideal}:a[r]=n.ideal,e.advanced.push(a),delete n.ideal,Object.keys(n).length||delete e[r]}}}),t.length&&(e.require=t),e};return e=JSON.parse(JSON.stringify(e)),t.version<38&&(a("spec: "+JSON.stringify(e)),e.audio&&(e.audio=s(e.audio)),e.video&&(e.video=s(e.video)),a("ff37: "+JSON.stringify(e))),r.mozGetUserMedia(e,n,function(e){i(o(e))})};if(r.mediaDevices||(r.mediaDevices={getUserMedia:function(e){return new Promise(function(t,r){s(e,t,r)})},addEventListener:function(){},removeEventListener:function(){}}),r.mediaDevices.enumerateDevices=r.mediaDevices.enumerateDevices||function(){return new Promise(function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},t.version<41){var c=r.mediaDevices.enumerateDevices.bind(r.mediaDevices);r.mediaDevices.enumerateDevices=function(){return c().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(t.version<49){var d=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(e){return d(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("The object can not be found here.","NotFoundError");return t},function(e){return Promise.reject(o(e))})}}if(!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){var l=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},p=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(e){return"object"==typeof e&&"object"==typeof e.audio&&(e=JSON.parse(JSON.stringify(e)),l(e.audio,"autoGainControl","mozAutoGainControl"),l(e.audio,"noiseSuppression","mozNoiseSuppression")),p(e)},i&&i.prototype.getSettings){var u=i.prototype.getSettings;i.prototype.getSettings=function(){var e=u.apply(this,arguments);return l(e,"mozAutoGainControl","autoGainControl"),l(e,"mozNoiseSuppression","noiseSuppression"),e}}if(i&&i.prototype.applyConstraints){var m=i.prototype.applyConstraints;i.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"==typeof e&&(e=JSON.parse(JSON.stringify(e)),l(e,"autoGainControl","mozAutoGainControl"),l(e,"noiseSuppression","mozNoiseSuppression")),m.apply(this,[e])}}}r.getUserMedia=function(e,a,i){if(t.version<44)return s(e,a,i);n.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(a,i)}}},function(e,t,r){"use strict";var n=r(0);e.exports={shimGetUserMedia:r(9),shimOnTrack:function(e){"object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var r=new Event("track");r.track=t,r.receiver={track:t},r.transceiver={receiver:r.receiver},r.streams=[e.stream],this.dispatchEvent(r)}.bind(this))}.bind(this))}}),"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(e){"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(e){var t=n.detectBrowser(e);if("object"==typeof e&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){e.RTCPeerConnection||(e.RTCPeerConnection=function(r,n){if(t.version<38&&r&&r.iceServers){for(var a=[],i=0;i<r.iceServers.length;i++){var o=r.iceServers[i];if(o.hasOwnProperty("urls"))for(var s=0;s<o.urls.length;s++){var c={url:o.urls[s]};0===o.urls[s].indexOf("turn")&&(c.username=o.username,c.credential=o.credential),a.push(c)}else a.push(r.iceServers[i])}r.iceServers=a}return new e.mozRTCPeerConnection(r,n)},e.RTCPeerConnection.prototype=e.mozRTCPeerConnection.prototype,e.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.mozRTCPeerConnection.generateCertificate}}),e.RTCSessionDescription=e.mozRTCSessionDescription,e.RTCIceCandidate=e.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}});var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var a={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,r,n){return i.apply(this,[e||null]).then(function(e){if(t.version<48&&(e=function(e){var t=new Map;return Object.keys(e).forEach(function(r){t.set(r,e[r]),t[r]=e[r]}),t}(e)),t.version<53&&!r)try{e.forEach(function(e){e.type=a[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach(function(t,r){e.set(r,Object.assign({},t,{type:a[t.type]||t.type}))})}return e}).then(r,n)}}},shimSenderGetStats:function(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(e,[]);return r.forEach(function(t){t._pc=e}),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},shimReceiverGetStats:function(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,r=t.apply(e,[]);return r.forEach(function(t){t._pc=e}),r}),n.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},shimRemoveStream:function(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;n.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(r){r.track&&-1!==e.getTracks().indexOf(r.track)&&t.removeTrack(r)})})},shimRTCDataChannel:function(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}}},function(e,t,r){"use strict";e.exports=function(e){var t=e&&e.navigator,r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return r(e).catch(function(e){return Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}}(e))})}}},function(e,t,r){"use strict";var n=r(3);function a(e,t,r,a,i){var o=n.writeRtpDescription(e.kind,t);if(o+=n.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=n.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":i||"active"),o+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var s=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=s;var c="msid:"+(a?a.id:"-")+" "+s+"\r\n";o+="a="+c,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+c,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+c,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+"\r\n"),o}function i(e,t){var r={codecs:[],headerExtensions:[],fecMechanisms:[]},n=function(e,t){e=parseInt(e,10);for(var r=0;r<t.length;r++)if(t[r].payloadType===e||t[r].preferredPayloadType===e)return t[r]},a=function(e,t,r,a){var i=n(e.parameters.apt,r),o=n(t.parameters.apt,a);return i&&o&&i.name.toLowerCase()===o.name.toLowerCase()};return e.codecs.forEach(function(n){for(var i=0;i<t.codecs.length;i++){var o=t.codecs[i];if(n.name.toLowerCase()===o.name.toLowerCase()&&n.clockRate===o.clockRate){if("rtx"===n.name.toLowerCase()&&n.parameters&&o.parameters.apt&&!a(n,o,e.codecs,t.codecs))continue;(o=JSON.parse(JSON.stringify(o))).numChannels=Math.min(n.numChannels,o.numChannels),r.codecs.push(o),o.rtcpFeedback=o.rtcpFeedback.filter(function(e){for(var t=0;t<n.rtcpFeedback.length;t++)if(n.rtcpFeedback[t].type===e.type&&n.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var n=0;n<t.headerExtensions.length;n++){var a=t.headerExtensions[n];if(e.uri===a.uri){r.headerExtensions.push(a);break}}}),r}function o(e,t,r){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(r)}function s(e,t){var r=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return r||e.addRemoteCandidate(t),!r}function c(e,t){var r=new Error(t);return r.name=e,r.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],r}e.exports=function(e,t){function r(t,r){r.addTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function d(t,r,n,a){var i=new Event("track");i.track=r,i.receiver=n,i.transceiver={receiver:n},i.streams=a,e.setTimeout(function(){t._dispatchEvent("track",i)})}var l=function(r){var a=this,i=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){a[e]=i[e].bind(i)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",r=JSON.parse(JSON.stringify(r||{})),this.usingBundle="max-bundle"===r.bundlePolicy,"negotiate"===r.rtcpMuxPolicy)throw c("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(r.rtcpMuxPolicy||(r.rtcpMuxPolicy="require"),r.iceTransportPolicy){case"all":case"relay":break;default:r.iceTransportPolicy="all"}switch(r.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:r.bundlePolicy="balanced"}if(r.iceServers=function(e,t){var r=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var n=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var a="string"==typeof n;return a&&(n=[n]),n=n.filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||r?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(r=!0,!0)}),delete e.url,e.urls=a?n[0]:n,!!n.length}})}(r.iceServers||[],t),this._iceGatherers=[],r.iceCandidatePoolSize)for(var o=r.iceCandidatePoolSize;o>0;o--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:r.iceServers,gatherPolicy:r.iceTransportPolicy}));else r.iceCandidatePoolSize=0;this._config=r,this.transceivers=[],this._sdpSessionId=n.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(l.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(l.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),l.prototype.onicecandidate=null,l.prototype.onaddstream=null,l.prototype.ontrack=null,l.prototype.onremovestream=null,l.prototype.onsignalingstatechange=null,l.prototype.oniceconnectionstatechange=null,l.prototype.onconnectionstatechange=null,l.prototype.onicegatheringstatechange=null,l.prototype.onnegotiationneeded=null,l.prototype.ondatachannel=null,l.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},l.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},l.prototype.getConfiguration=function(){return this._config},l.prototype.getLocalStreams=function(){return this.localStreams},l.prototype.getRemoteStreams=function(){return this.remoteStreams},l.prototype._createTransceiver=function(e,t){var r=this.transceivers.length>0,n={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&r)n.iceTransport=this.transceivers[0].iceTransport,n.dtlsTransport=this.transceivers[0].dtlsTransport;else{var a=this._createIceAndDtlsTransports();n.iceTransport=a.iceTransport,n.dtlsTransport=a.dtlsTransport}return t||this.transceivers.push(n),n},l.prototype.addTrack=function(t,r){if(this._isClosed)throw c("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var n;if(this.transceivers.find(function(e){return e.track===t}))throw c("InvalidAccessError","Track already exists.");for(var a=0;a<this.transceivers.length;a++)this.transceivers[a].track||this.transceivers[a].kind!==t.kind||(n=this.transceivers[a]);return n||(n=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(r)&&this.localStreams.push(r),n.track=t,n.stream=r,n.rtpSender=new e.RTCRtpSender(t,n.dtlsTransport),n.rtpSender},l.prototype.addStream=function(e){var r=this;if(t>=15025)e.getTracks().forEach(function(t){r.addTrack(t,e)});else{var n=e.clone();e.getTracks().forEach(function(e,t){var r=n.getTracks()[t];e.addEventListener("enabled",function(e){r.enabled=e.enabled})}),n.getTracks().forEach(function(e){r.addTrack(e,n)})}},l.prototype.removeTrack=function(t){if(this._isClosed)throw c("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var r=this.transceivers.find(function(e){return e.rtpSender===t});if(!r)throw c("InvalidAccessError","Sender was not created by this connection.");var n=r.stream;r.rtpSender.stop(),r.rtpSender=null,r.track=null,r.stream=null,-1===this.transceivers.map(function(e){return e.stream}).indexOf(n)&&this.localStreams.indexOf(n)>-1&&this.localStreams.splice(this.localStreams.indexOf(n),1),this._maybeFireNegotiationNeeded()},l.prototype.removeStream=function(e){var t=this;e.getTracks().forEach(function(e){var r=t.getSenders().find(function(t){return t.track===e});r&&t.removeTrack(r)})},l.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},l.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},l.prototype._createIceGatherer=function(t,r){var n=this;if(r&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var a=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(a,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var r=!e.candidate||0===Object.keys(e.candidate).length;a.state=r?"completed":"gathering",null!==n.transceivers[t].bufferedCandidateEvents&&n.transceivers[t].bufferedCandidateEvents.push(e)},a.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),a},l.prototype._gather=function(t,r){var a=this,i=this.transceivers[r].iceGatherer;if(!i.onlocalcandidate){var o=this.transceivers[r].bufferedCandidateEvents;this.transceivers[r].bufferedCandidateEvents=null,i.removeEventListener("localcandidate",this.transceivers[r].bufferCandidates),i.onlocalcandidate=function(e){if(!(a.usingBundle&&r>0)){var o=new Event("icecandidate");o.candidate={sdpMid:t,sdpMLineIndex:r};var s=e.candidate,c=!s||0===Object.keys(s).length;if(c)"new"!==i.state&&"gathering"!==i.state||(i.state="completed");else{"new"===i.state&&(i.state="gathering"),s.component=1,s.ufrag=i.getLocalParameters().usernameFragment;var d=n.writeCandidate(s);o.candidate=Object.assign(o.candidate,n.parseCandidate(d)),o.candidate.candidate=d,o.candidate.toJSON=function(){return{candidate:o.candidate.candidate,sdpMid:o.candidate.sdpMid,sdpMLineIndex:o.candidate.sdpMLineIndex,usernameFragment:o.candidate.usernameFragment}}}var l=n.getMediaSections(a._localDescription.sdp);l[o.candidate.sdpMLineIndex]+=c?"a=end-of-candidates\r\n":"a="+o.candidate.candidate+"\r\n",a._localDescription.sdp=n.getDescription(a._localDescription.sdp)+l.join("");var p=a.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==a.iceGatheringState&&(a.iceGatheringState="gathering",a._emitGatheringStateChange()),c||a._dispatchEvent("icecandidate",o),p&&(a._dispatchEvent("icecandidate",new Event("icecandidate")),a.iceGatheringState="complete",a._emitGatheringStateChange())}},e.setTimeout(function(){o.forEach(function(e){i.onlocalcandidate(e)})},0)}},l.prototype._createIceAndDtlsTransports=function(){var t=this,r=new e.RTCIceTransport(null);r.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var n=new e.RTCDtlsTransport(r);return n.ondtlsstatechange=function(){t._updateConnectionState()},n.onerror=function(){Object.defineProperty(n,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:r,dtlsTransport:n}},l.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var r=this.transceivers[e].iceTransport;r&&(delete r.onicestatechange,delete this.transceivers[e].iceTransport);var n=this.transceivers[e].dtlsTransport;n&&(delete n.ondtlsstatechange,delete n.onerror,delete this.transceivers[e].dtlsTransport)},l.prototype._transceive=function(e,r,a){var o=i(e.localCapabilities,e.remoteCapabilities);r&&e.rtpSender&&(o.encodings=e.sendEncodingParameters,o.rtcp={cname:n.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(o.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(o)),a&&e.rtpReceiver&&o.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),e.recvEncodingParameters.length?o.encodings=e.recvEncodingParameters:o.encodings=[{}],o.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(o.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(o.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(o))},l.prototype.setLocalDescription=function(e){var t,r,a=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(c("TypeError",'Unsupported type "'+e.type+'"'));if(!o("setLocalDescription",e.type,a.signalingState)||a._isClosed)return Promise.reject(c("InvalidStateError","Can not set local "+e.type+" in state "+a.signalingState));if("offer"===e.type)t=n.splitSections(e.sdp),r=t.shift(),t.forEach(function(e,t){var r=n.parseRtpParameters(e);a.transceivers[t].localCapabilities=r}),a.transceivers.forEach(function(e,t){a._gather(e.mid,t)});else if("answer"===e.type){t=n.splitSections(a._remoteDescription.sdp),r=t.shift();var s=n.matchPrefix(r,"a=ice-lite").length>0;t.forEach(function(e,t){var o=a.transceivers[t],c=o.iceGatherer,d=o.iceTransport,l=o.dtlsTransport,p=o.localCapabilities,u=o.remoteCapabilities;if(!(n.isRejected(e)&&0===n.matchPrefix(e,"a=bundle-only").length||o.rejected)){var m=n.getIceParameters(e,r),f=n.getDtlsParameters(e,r);s&&(f.role="server"),a.usingBundle&&0!==t||(a._gather(o.mid,t),"new"===d.state&&d.start(c,m,s?"controlling":"controlled"),"new"===l.state&&l.start(f));var h=i(p,u);a._transceive(o,h.codecs.length>0,!1)}})}return a._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?a._updateSignalingState("have-local-offer"):a._updateSignalingState("stable"),Promise.resolve()},l.prototype.setRemoteDescription=function(a){var i=this;if(-1===["offer","answer"].indexOf(a.type))return Promise.reject(c("TypeError",'Unsupported type "'+a.type+'"'));if(!o("setRemoteDescription",a.type,i.signalingState)||i._isClosed)return Promise.reject(c("InvalidStateError","Can not set remote "+a.type+" in state "+i.signalingState));var l={};i.remoteStreams.forEach(function(e){l[e.id]=e});var p=[],u=n.splitSections(a.sdp),m=u.shift(),f=n.matchPrefix(m,"a=ice-lite").length>0,h=n.matchPrefix(m,"a=group:BUNDLE ").length>0;i.usingBundle=h;var v=n.matchPrefix(m,"a=ice-options:")[0];return i.canTrickleIceCandidates=!!v&&v.substr(14).split(" ").indexOf("trickle")>=0,u.forEach(function(o,c){var d=n.splitLines(o),u=n.getKind(o),v=n.isRejected(o)&&0===n.matchPrefix(o,"a=bundle-only").length,g=d[0].substr(2).split(" ")[2],y=n.getDirection(o,m),R=n.parseMsid(o),C=n.getMid(o)||n.generateIdentifier();if(v||"application"===u&&("DTLS/SCTP"===g||"UDP/DTLS/SCTP"===g))i.transceivers[c]={mid:C,kind:u,protocol:g,rejected:!0};else{var E,S,T,b,P,w,k,_,N;!v&&i.transceivers[c]&&i.transceivers[c].rejected&&(i.transceivers[c]=i._createTransceiver(u,!0));var O,x,D=n.parseRtpParameters(o);v||(O=n.getIceParameters(o,m),(x=n.getDtlsParameters(o,m)).role="client"),k=n.parseRtpEncodingParameters(o);var I=n.parseRtcpParameters(o),M=n.matchPrefix(o,"a=end-of-candidates",m).length>0,L=n.matchPrefix(o,"a=candidate:").map(function(e){return n.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===a.type||"answer"===a.type)&&!v&&h&&c>0&&i.transceivers[c]&&(i._disposeIceAndDtlsTransports(c),i.transceivers[c].iceGatherer=i.transceivers[0].iceGatherer,i.transceivers[c].iceTransport=i.transceivers[0].iceTransport,i.transceivers[c].dtlsTransport=i.transceivers[0].dtlsTransport,i.transceivers[c].rtpSender&&i.transceivers[c].rtpSender.setTransport(i.transceivers[0].dtlsTransport),i.transceivers[c].rtpReceiver&&i.transceivers[c].rtpReceiver.setTransport(i.transceivers[0].dtlsTransport)),"offer"!==a.type||v)"answer"!==a.type||v||(S=(E=i.transceivers[c]).iceGatherer,T=E.iceTransport,b=E.dtlsTransport,P=E.rtpReceiver,w=E.sendEncodingParameters,_=E.localCapabilities,i.transceivers[c].recvEncodingParameters=k,i.transceivers[c].remoteCapabilities=D,i.transceivers[c].rtcpParameters=I,L.length&&"new"===T.state&&(!f&&!M||h&&0!==c?L.forEach(function(e){s(E.iceTransport,e)}):T.setRemoteCandidates(L)),h&&0!==c||("new"===T.state&&T.start(S,O,"controlling"),"new"===b.state&&b.start(x)),i._transceive(E,"sendrecv"===y||"recvonly"===y,"sendrecv"===y||"sendonly"===y),!P||"sendrecv"!==y&&"sendonly"!==y?delete E.rtpReceiver:(N=P.track,R?(l[R.stream]||(l[R.stream]=new e.MediaStream),r(N,l[R.stream]),p.push([N,P,l[R.stream]])):(l.default||(l.default=new e.MediaStream),r(N,l.default),p.push([N,P,l.default]))));else{(E=i.transceivers[c]||i._createTransceiver(u)).mid=C,E.iceGatherer||(E.iceGatherer=i._createIceGatherer(c,h)),L.length&&"new"===E.iceTransport.state&&(!M||h&&0!==c?L.forEach(function(e){s(E.iceTransport,e)}):E.iceTransport.setRemoteCandidates(L)),_=e.RTCRtpReceiver.getCapabilities(u),t<15019&&(_.codecs=_.codecs.filter(function(e){return"rtx"!==e.name})),w=E.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var j,A=!1;"sendrecv"===y||"sendonly"===y?(A=!E.rtpReceiver,P=E.rtpReceiver||new e.RTCRtpReceiver(E.dtlsTransport,u),A&&(N=P.track,R&&"-"===R.stream||(R?(l[R.stream]||(l[R.stream]=new e.MediaStream,Object.defineProperty(l[R.stream],"id",{get:function(){return R.stream}})),Object.defineProperty(N,"id",{get:function(){return R.track}}),j=l[R.stream]):(l.default||(l.default=new e.MediaStream),j=l.default)),j&&(r(N,j),E.associatedRemoteMediaStreams.push(j)),p.push([N,P,j]))):E.rtpReceiver&&E.rtpReceiver.track&&(E.associatedRemoteMediaStreams.forEach(function(t){var r,n,a=t.getTracks().find(function(e){return e.id===E.rtpReceiver.track.id});a&&(r=a,(n=t).removeTrack(r),n.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:r})))}),E.associatedRemoteMediaStreams=[]),E.localCapabilities=_,E.remoteCapabilities=D,E.rtpReceiver=P,E.rtcpParameters=I,E.sendEncodingParameters=w,E.recvEncodingParameters=k,i._transceive(i.transceivers[c],!1,A)}}}),void 0===i._dtlsRole&&(i._dtlsRole="offer"===a.type?"active":"passive"),i._remoteDescription={type:a.type,sdp:a.sdp},"offer"===a.type?i._updateSignalingState("have-remote-offer"):i._updateSignalingState("stable"),Object.keys(l).forEach(function(t){var r=l[t];if(r.getTracks().length){if(-1===i.remoteStreams.indexOf(r)){i.remoteStreams.push(r);var n=new Event("addstream");n.stream=r,e.setTimeout(function(){i._dispatchEvent("addstream",n)})}p.forEach(function(e){var t=e[0],n=e[1];r.id===e[2].id&&d(i,t,n,[r])})}}),p.forEach(function(e){e[2]||d(i,e[0],e[1],[])}),e.setTimeout(function(){i&&i.transceivers&&i.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},l.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},l.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},l.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}},0))},l.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++}),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var r=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",r)}},l.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++,t[e.dtlsTransport.state]++}),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var r=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",r)}},l.prototype.createOffer=function(){var r=this;if(r._isClosed)return Promise.reject(c("InvalidStateError","Can not call createOffer after close"));var i=r.transceivers.filter(function(e){return"audio"===e.kind}).length,o=r.transceivers.filter(function(e){return"video"===e.kind}).length,s=arguments[0];if(s){if(s.mandatory||s.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==s.offerToReceiveAudio&&(i=!0===s.offerToReceiveAudio?1:!1===s.offerToReceiveAudio?0:s.offerToReceiveAudio),void 0!==s.offerToReceiveVideo&&(o=!0===s.offerToReceiveVideo?1:!1===s.offerToReceiveVideo?0:s.offerToReceiveVideo)}for(r.transceivers.forEach(function(e){"audio"===e.kind?--i<0&&(e.wantReceive=!1):"video"===e.kind&&--o<0&&(e.wantReceive=!1)});i>0||o>0;)i>0&&(r._createTransceiver("audio"),i--),o>0&&(r._createTransceiver("video"),o--);var d=n.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.transceivers.forEach(function(a,i){var o=a.track,s=a.kind,c=a.mid||n.generateIdentifier();a.mid=c,a.iceGatherer||(a.iceGatherer=r._createIceGatherer(i,r.usingBundle));var d=e.RTCRtpSender.getCapabilities(s);t<15019&&(d.codecs=d.codecs.filter(function(e){return"rtx"!==e.name})),d.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),a.remoteCapabilities&&a.remoteCapabilities.codecs&&a.remoteCapabilities.codecs.forEach(function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)})}),d.headerExtensions.forEach(function(e){(a.remoteCapabilities&&a.remoteCapabilities.headerExtensions||[]).forEach(function(t){e.uri===t.uri&&(e.id=t.id)})});var l=a.sendEncodingParameters||[{ssrc:1001*(2*i+1)}];o&&t>=15019&&"video"===s&&!l[0].rtx&&(l[0].rtx={ssrc:l[0].ssrc+1}),a.wantReceive&&(a.rtpReceiver=new e.RTCRtpReceiver(a.dtlsTransport,s)),a.localCapabilities=d,a.sendEncodingParameters=l}),"max-compat"!==r._config.bundlePolicy&&(d+="a=group:BUNDLE "+r.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),d+="a=ice-options:trickle\r\n",r.transceivers.forEach(function(e,t){d+=a(e,e.localCapabilities,"offer",e.stream,r._dtlsRole),d+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===r.iceGatheringState||0!==t&&r.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,d+="a="+n.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(d+="a=end-of-candidates\r\n"))});var l=new e.RTCSessionDescription({type:"offer",sdp:d});return Promise.resolve(l)},l.prototype.createAnswer=function(){var r=this;if(r._isClosed)return Promise.reject(c("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==r.signalingState&&"have-local-pranswer"!==r.signalingState)return Promise.reject(c("InvalidStateError","Can not call createAnswer in signalingState "+r.signalingState));var o=n.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.usingBundle&&(o+="a=group:BUNDLE "+r.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n");var s=n.getMediaSections(r._remoteDescription.sdp).length;r.transceivers.forEach(function(e,n){if(!(n+1>s)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?o+="m=application 0 DTLS/SCTP 5000\r\n":o+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?o+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(o+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(o+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var c;e.stream&&("audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1}));var d=i(e.localCapabilities,e.remoteCapabilities);!d.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,o+=a(e,d,"answer",e.stream,r._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(o+="a=rtcp-rsize\r\n")}});var d=new e.RTCSessionDescription({type:"answer",sdp:o});return Promise.resolve(d)},l.prototype.addIceCandidate=function(e){var t,r=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(a,i){if(!r._remoteDescription)return i(c("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var o=e.sdpMLineIndex;if(e.sdpMid)for(var d=0;d<r.transceivers.length;d++)if(r.transceivers[d].mid===e.sdpMid){o=d;break}var l=r.transceivers[o];if(!l)return i(c("OperationError","Can not add ICE candidate"));if(l.rejected)return a();var p=Object.keys(e.candidate).length>0?n.parseCandidate(e.candidate):{};if("tcp"===p.protocol&&(0===p.port||9===p.port))return a();if(p.component&&1!==p.component)return a();if((0===o||o>0&&l.iceTransport!==r.transceivers[0].iceTransport)&&!s(l.iceTransport,p))return i(c("OperationError","Can not add ICE candidate"));var u=e.candidate.trim();0===u.indexOf("a=")&&(u=u.substr(2)),(t=n.getMediaSections(r._remoteDescription.sdp))[o]+="a="+(p.type?u:"end-of-candidates")+"\r\n",r._remoteDescription.sdp=n.getDescription(r._remoteDescription.sdp)+t.join("")}else for(var m=0;m<r.transceivers.length&&(r.transceivers[m].rejected||(r.transceivers[m].iceTransport.addRemoteCandidate({}),(t=n.getMediaSections(r._remoteDescription.sdp))[m]+="a=end-of-candidates\r\n",r._remoteDescription.sdp=n.getDescription(r._remoteDescription.sdp)+t.join(""),!r.usingBundle));m++);a()})},l.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var r=null;if(this.transceivers.forEach(function(e){e.rtpSender&&e.rtpSender.track===t?r=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(r=e.rtpReceiver)}),!r)throw c("InvalidAccessError","Invalid selector.");return r.getStats()}var n=[];return this.transceivers.forEach(function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(t){e[t]&&n.push(e[t].getStats())})}),Promise.all(n).then(function(e){var t=new Map;return e.forEach(function(e){e.forEach(function(e){t.set(e.id,e)})}),t})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(t){var r=e[t];if(r&&r.prototype&&r.prototype.getStats){var n=r.prototype.getStats;r.prototype.getStats=function(){return n.apply(this).then(function(e){var t=new Map;return Object.keys(e).forEach(function(r){var n;e[r].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(n=e[r]).type]||n.type,t.set(r,e[r])}),t})}}});var p=["createOffer","createAnswer"];return p.forEach(function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then(function(t){"function"==typeof e[0]&&e[0].apply(null,[t])},function(t){"function"==typeof e[1]&&e[1].apply(null,[t])}):t.apply(this,arguments)}}),(p=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)},function(t){"function"==typeof e[2]&&e[2].apply(null,[t])}):t.apply(this,arguments)}}),["getStats"].forEach(function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),l}},function(e,t,r){"use strict";var n=r(0);e.exports=function(e,t){var r=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var a=e.urls||e.url;e.url&&!e.urls&&n.deprecated("RTCIceServer.url","RTCIceServer.urls");var i="string"==typeof a;return i&&(a=[a]),a=a.filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||r?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(r=!0,!0)}),delete e.url,e.urls=i?a[0]:a,!!a.length}})}},function(e,t,r){"use strict";var n=r(0),a=r(13),i=r(12);e.exports={shimGetUserMedia:r(11),shimPeerConnection:function(e){var t=n.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var r=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){r.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var o=i(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=a(e.iceServers)),new o(e)},e.RTCPeerConnection.prototype=o.prototype},shimReplaceTrack:function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}}},function(e,t,r){"use strict";var n=r(0),a=n.log;e.exports=function(e){var t=n.detectBrowser(e),r=e&&e.navigator,i=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var n="object"==typeof e[r]?e[r]:{ideal:e[r]};void 0!==n.exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact);var a=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==n.ideal){t.optional=t.optional||[];var i={};"number"==typeof n.ideal?(i[a("min",r)]=n.ideal,t.optional.push(i),(i={})[a("max",r)]=n.ideal,t.optional.push(i)):(i[a("",r)]=n.ideal,t.optional.push(i))}void 0!==n.exact&&"number"!=typeof n.exact?(t.mandatory=t.mandatory||{},t.mandatory[a("",r)]=n.exact):["min","max"].forEach(function(e){void 0!==n[e]&&(t.mandatory=t.mandatory||{},t.mandatory[a(e,r)]=n[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},o=function(e,n){if(t.version>=61)return n(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){var o=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};o((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),o(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=i(e.audio)}if(e&&"object"==typeof e.video){var s=e.video.facingMode;s=s&&("object"==typeof s?s:{ideal:s});var c,d=t.version<66;if(s&&("user"===s.exact||"environment"===s.exact||"user"===s.ideal||"environment"===s.ideal)&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||d)&&(delete e.video.facingMode,"environment"===s.exact||"environment"===s.ideal?c=["back","rear"]:"user"!==s.exact&&"user"!==s.ideal||(c=["front"]),c))return r.mediaDevices.enumerateDevices().then(function(t){var r=(t=t.filter(function(e){return"videoinput"===e.kind})).find(function(e){return c.some(function(t){return-1!==e.label.toLowerCase().indexOf(t)})});return!r&&t.length&&-1!==c.indexOf("back")&&(r=t[t.length-1]),r&&(e.video.deviceId=s.exact?{exact:r.deviceId}:{ideal:r.deviceId}),e.video=i(e.video),a("chrome: "+JSON.stringify(e)),n(e)});e.video=i(e.video)}return a("chrome: "+JSON.stringify(e)),n(e)},s=function(e){return{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};r.getUserMedia=function(e,t,n){o(e,function(e){r.webkitGetUserMedia(e,t,function(e){n&&n(s(e))})})};var c=function(e){return new Promise(function(t,n){r.getUserMedia(e,t,n)})};if(r.mediaDevices||(r.mediaDevices={getUserMedia:c,enumerateDevices:function(){return new Promise(function(t){var r={audio:"audioinput",video:"videoinput"};return e.MediaStreamTrack.getSources(function(e){t(e.map(function(e){return{label:e.label,kind:r[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),r.mediaDevices.getUserMedia){var d=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(e){return o(e,function(e){return d(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(s(e))})})}}else r.mediaDevices.getUserMedia=function(e){return c(e)};void 0===r.mediaDevices.addEventListener&&(r.mediaDevices.addEventListener=function(){a("Dummy mediaDevices.addEventListener called.")}),void 0===r.mediaDevices.removeEventListener&&(r.mediaDevices.removeEventListener=function(){a("Dummy mediaDevices.removeEventListener called.")})}},function(e,t,r){"use strict";var n=r(0),a=n.log;function i(e,t,r){var n=r?"outbound-rtp":"inbound-rtp",a=new Map;if(null===t)return a;var i=[];return e.forEach(function(e){"track"===e.type&&e.trackIdentifier===t.id&&i.push(e)}),i.forEach(function(t){e.forEach(function(r){r.type===n&&r.trackId===t.id&&function e(t,r,n){r&&!n.has(r.id)&&(n.set(r.id,r),Object.keys(r).forEach(function(a){a.endsWith("Id")?e(t,t.get(r[a]),n):a.endsWith("Ids")&&r[a].forEach(function(r){e(t,t.get(r),n)})}))}(e,r,a)})}),a}e.exports={shimGetUserMedia:r(15),shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(e){if("object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype)"RTCRtpTransceiver"in e||n.wrapPeerConnectionEvent(e,"track",function(e){return e.transceiver||(e.transceiver={receiver:e.receiver}),e});else{Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var r=this;return r._ontrackpoly||(r._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(n){var a;a=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(e){return e.track&&e.track.id===n.track.id}):{track:n.track};var i=new Event("track");i.track=n.track,i.receiver=a,i.transceiver={receiver:a},i.streams=[t.stream],r.dispatchEvent(i)}),t.stream.getTracks().forEach(function(n){var a;a=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(e){return e.track&&e.track.id===n.id}):{track:n};var i=new Event("track");i.track=n,i.receiver=a,i.transceiver={receiver:a},i.streams=[t.stream],r.dispatchEvent(i)})},r.addEventListener("addstream",r._ontrackpoly)),t.apply(r,arguments)}}},shimGetSendersWithDtmf:function(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){var a=r.apply(this,arguments);return a||(a=t(this,e),this._senders.push(a)),a};var n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){n.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var a=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;r._senders=r._senders||[],a.apply(r,[e]),e.getTracks().forEach(function(e){r._senders.push(t(r,e))})};var i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._senders=t._senders||[],i.apply(t,[e]),e.getTracks().forEach(function(e){var r=t._senders.find(function(t){return t.track===e});r&&t._senders.splice(t._senders.indexOf(r),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var o=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=o.apply(e,[]);return t.forEach(function(t){t._pc=e}),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSenderReceiverGetStats:function(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(e,[]);return r.forEach(function(t){t._pc=e}),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return i(t,e.track,!0)})}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var a=e.RTCPeerConnection.prototype.getReceivers;a&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=a.apply(e,[]);return t.forEach(function(t){t._pc=e}),t}),n.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return i(t,e.track,!1)})}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t,r,n,a=arguments[0];return this.getSenders().forEach(function(e){e.track===a&&(t?n=!0:t=e)}),this.getReceivers().forEach(function(e){return e.track===a&&(r?n=!0:r=e),e.track===a}),n||t&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return o.apply(this,arguments)}}}},shimSourceObject:function(e){var t=e&&e.URL;"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var r=this;this._srcObject=e,this.src&&t.revokeObjectURL(this.src),e?(this.src=t.createObjectURL(e),e.addEventListener("addtrack",function(){r.src&&t.revokeObjectURL(r.src),r.src=t.createObjectURL(e)}),e.addEventListener("removetrack",function(){r.src&&t.revokeObjectURL(r.src),r.src=t.createObjectURL(e)})):this.src=""}}))},shimAddTrackRemoveTrackWithNative:function(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(t){return e._shimmedLocalStreams[t][0]})};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var n=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===this._shimmedLocalStreams[r.id].indexOf(n)&&this._shimmedLocalStreams[r.id].push(n):this._shimmedLocalStreams[r.id]=[r,n],n};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(function(e){if(t.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")});var n=t.getSenders();r.apply(this,arguments);var a=t.getSenders().filter(function(e){return-1===n.indexOf(e)});this._shimmedLocalStreams[e.id]=[e].concat(a)};var n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],n.apply(this,arguments)};var a=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(function(r){var n=t._shimmedLocalStreams[r].indexOf(e);-1!==n&&t._shimmedLocalStreams[r].splice(n,1),1===t._shimmedLocalStreams[r].length&&delete t._shimmedLocalStreams[r]}),a.apply(this,arguments)}},shimAddTrackRemoveTrack:function(e){var t=n.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return this.shimAddTrackRemoveTrackWithNative(e);var r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=r.apply(this);return e._reverseStreams=e._reverseStreams||{},t.map(function(t){return e._reverseStreams[t.id]})};var a=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var r=this;if(r._streams=r._streams||{},r._reverseStreams=r._reverseStreams||{},t.getTracks().forEach(function(e){if(r.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")}),!r._reverseStreams[t.id]){var n=new e.MediaStream(t.getTracks());r._streams[t.id]=n,r._reverseStreams[n.id]=t,t=n}a.apply(r,[t])};var i=e.RTCPeerConnection.prototype.removeStream;function o(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var n=e._reverseStreams[t],a=e._streams[n.id];r=r.replace(new RegExp(a.id,"g"),n.id)}),new RTCSessionDescription({type:t.type,sdp:r})}e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._streams=t._streams||{},t._reverseStreams=t._reverseStreams||{},i.apply(t,[t._streams[e.id]||e]),delete t._reverseStreams[t._streams[e.id]?t._streams[e.id].id:e.id],delete t._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){var n=this;if("closed"===n.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var a=[].slice.call(arguments,1);if(1!==a.length||!a[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(n.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError");n._streams=n._streams||{},n._reverseStreams=n._reverseStreams||{};var i=n._streams[r.id];if(i)i.addTrack(t),Promise.resolve().then(function(){n.dispatchEvent(new Event("negotiationneeded"))});else{var o=new e.MediaStream([t]);n._streams[r.id]=o,n._reverseStreams[o.id]=r,n.addStream(o)}return n.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this,t=arguments;return arguments.length&&"function"==typeof arguments[0]?r.apply(e,[function(r){var n=o(e,r);t[0].apply(null,[n])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):r.apply(e,arguments).then(function(t){return o(e,t)})}});var s=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var n=e._reverseStreams[t],a=e._streams[n.id];r=r.replace(new RegExp(n.id,"g"),a.id)}),new RTCSessionDescription({type:t.type,sdp:r})}(this,arguments[0]),s.apply(this,arguments)):s.apply(this,arguments)};var c=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=c.get.apply(this);return""===e.type?e:o(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t,r=this;if("closed"===r.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==r)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");r._streams=r._streams||{},Object.keys(r._streams).forEach(function(n){r._streams[n].getTracks().find(function(t){return e.track===t})&&(t=r._streams[n])}),t&&(1===t.getTracks().length?r.removeStream(r._reverseStreams[t.id]):t.removeTrack(e.track),r.dispatchEvent(new Event("negotiationneeded")))}},shimPeerConnection:function(e){var t=n.detectBrowser(e);if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection)e.RTCPeerConnection=function(t,r){return a("PeerConnection"),t&&t.iceTransportPolicy&&(t.iceTransports=t.iceTransportPolicy),new e.webkitRTCPeerConnection(t,r)},e.RTCPeerConnection.prototype=e.webkitRTCPeerConnection.prototype,e.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.webkitRTCPeerConnection.generateCertificate}});else{var r=e.RTCPeerConnection;e.RTCPeerConnection=function(e,t){if(e&&e.iceServers){for(var a=[],i=0;i<e.iceServers.length;i++){var o=e.iceServers[i];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(n.deprecated("RTCIceServer.url","RTCIceServer.urls"),(o=JSON.parse(JSON.stringify(o))).urls=o.url,a.push(o)):a.push(e.iceServers[i])}e.iceServers=a}return new r(e,t)},e.RTCPeerConnection.prototype=r.prototype,Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return r.generateCertificate}})}var i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,t,r){var n=this,a=arguments;if(arguments.length>0&&"function"==typeof e)return i.apply(this,arguments);if(0===i.length&&(0===arguments.length||"function"!=typeof arguments[0]))return i.apply(this,[]);var o=function(e){var t={};return e.result().forEach(function(e){var r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){r[t]=e.stat(t)}),t[r.id]=r}),t},s=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};return arguments.length>=2?i.apply(this,[function(e){a[1](s(o(e)))},arguments[0]]):new Promise(function(e,t){i.apply(n,[function(t){e(s(o(t)))},t])}).then(t,r)},t.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=arguments,t=this,n=new Promise(function(n,a){r.apply(t,[e[0],n,a])});return e.length<2?n:n.then(function(){e[1].apply(null,[])},function(t){e.length>=3&&e[2].apply(null,[t])})}}),t.version<52&&["createOffer","createAnswer"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var t=1===arguments.length?arguments[0]:void 0;return new Promise(function(n,a){r.apply(e,[n,a,t])})}return r.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}});var o=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?o.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}}},function(e,t,r){"use strict";var n=r(0);e.exports=function(e,t){var a=e&&e.window,i={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var o in t)hasOwnProperty.call(t,o)&&(i[o]=t[o]);var s=n.log,c=n.detectBrowser(a),d=r(16)||null,l=r(14)||null,p=r(10)||null,u=r(8)||null,m=r(7)||null,f={browserDetails:c,commonShim:m,extractVersion:n.extractVersion,disableLog:n.disableLog,disableWarnings:n.disableWarnings};switch(c.browser){case"chrome":if(!d||!d.shimPeerConnection||!i.shimChrome)return s("Chrome shim is not included in this adapter release."),f;s("adapter.js shimming chrome."),f.browserShim=d,m.shimCreateObjectURL(a),d.shimGetUserMedia(a),d.shimMediaStream(a),d.shimSourceObject(a),d.shimPeerConnection(a),d.shimOnTrack(a),d.shimAddTrackRemoveTrack(a),d.shimGetSendersWithDtmf(a),d.shimSenderReceiverGetStats(a),m.shimRTCIceCandidate(a),m.shimMaxMessageSize(a),m.shimSendThrowTypeError(a);break;case"firefox":if(!p||!p.shimPeerConnection||!i.shimFirefox)return s("Firefox shim is not included in this adapter release."),f;s("adapter.js shimming firefox."),f.browserShim=p,m.shimCreateObjectURL(a),p.shimGetUserMedia(a),p.shimSourceObject(a),p.shimPeerConnection(a),p.shimOnTrack(a),p.shimRemoveStream(a),p.shimSenderGetStats(a),p.shimReceiverGetStats(a),p.shimRTCDataChannel(a),m.shimRTCIceCandidate(a),m.shimMaxMessageSize(a),m.shimSendThrowTypeError(a);break;case"edge":if(!l||!l.shimPeerConnection||!i.shimEdge)return s("MS edge shim is not included in this adapter release."),f;s("adapter.js shimming edge."),f.browserShim=l,m.shimCreateObjectURL(a),l.shimGetUserMedia(a),l.shimPeerConnection(a),l.shimReplaceTrack(a),m.shimMaxMessageSize(a),m.shimSendThrowTypeError(a);break;case"safari":if(!u||!i.shimSafari)return s("Safari shim is not included in this adapter release."),f;s("adapter.js shimming safari."),f.browserShim=u,m.shimCreateObjectURL(a),u.shimRTCIceServerUrls(a),u.shimCallbacksAPI(a),u.shimLocalStreamsAPI(a),u.shimRemoteStreamsAPI(a),u.shimTrackEventTransceiver(a),u.shimGetUserMedia(a),u.shimCreateOfferLegacy(a),m.shimRTCIceCandidate(a),m.shimMaxMessageSize(a),m.shimSendThrowTypeError(a);break;default:s("Unsupported browser!")}return f}},function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";(function(t){var n=r(17);e.exports=n({window:t.window})}).call(this,r(18))},function(e,t,r){window,e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r(r.s=0)}([function(e,t,r){"use strict";function n(e){return!0===e||!1===e}r.r(t);var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};t.default=class{constructor(e){if(this.options=a({},{peerConnection:null,interval:3e3,isVisible:!0},e),this.body=document.querySelector("body"),this.id=function(e,t,r,a){var i="",o="";for(isNaN(e)&&(e=32),n(t)||(t=!1),n(r)||(r=!0),n(a)||(a=!0),t&&(i+="ABCDEFGHIJKLMNOPQRSTUVWXYZ"),r&&(i+="abcdefghijklmnopqrstuvwxyz"),a&&(i+="0123456789");o.length<e;)o+=i.substr(Math.floor(i.length*Math.random()),1);return o}(10,!1,!0,!1),this.options.peerConnection instanceof RTCPeerConnection==0)throw new Error("[Analyzer]: peerConnection must be an instance of RTCPeerConnection.");if("number"!=typeof this.options.interval)throw new Error("[Analyzer]: interval has to be a number.");if(0==(!0===this.options.isVisible||!1===this.options.isVisible))throw new Error("[Analyzer]: isVisible has to be a boolean (true or false).");this.handleKeyDown=this.handleKeyDown.bind(this),this.wasCTRL=!1,this.isVisible=this.options.isVisible,this.setup()}setup(){this.interval=setInterval(()=>{this.options.peerConnection.getStats().then(e=>{this.render(e)})},this.options.interval),this.setKeyHandler()}generateFromPCState(e,t){return`<tr><td>${e}</td><td>${this.options.peerConnection[t]}</td></tr>`}generateHeader(e){return`<header>${e}</header>`}clearStage(){null!==this.body.querySelector("#"+this.id)&&this.body.querySelector("#"+this.id).remove()}renderToStage(e){let t=document.createElement("div");t.id=this.id,t.innerHTML=e,this.body.appendChild(t)}generateFromObject(e){let t="";return Object.keys(e).forEach(r=>{t+=`<tr><td>${r}</td><td>${e[r]}</td></tr>`}),t}generateIsVisibleClass(){return!1===this.isVisible?" hidden":""}render(e){let t=document.querySelector(`body #${this.id} .webrtc-analyzer main`),r=0;null!==t&&(r=t.scrollTop),this.clearStage();let n=`<div class="webrtc-analyzer${this.generateIsVisibleClass()}"><div class="box"><main>`;e.forEach(e=>{n+=this.generateHeader(function(e){return"certificate"===e?"Certificate":"codec"===e?"Codec":"candidate-pair"===e?"Candidate Pair":"remote-candidate"===e?"Remote candidate":"local-candidate"===e?"Local candidate":"inbound-rtp"===e?"Inbound RTP":"track"===e?"Track":"stream"===e?"Stream":"outbound-rtp"===e?"Outbound RTP":"peer-connection"===e?"Peer connection":"transport"===e?"Transport":"Unknown"}(e.type)),n+="<table>",n+=this.generateFromObject(e),n+="</table>"}),n+=this.generateHeader("PeerConnection states"),n+="<table>",n+=this.generateFromPCState("Signaling state","signalingState"),n+=this.generateFromPCState("ICE gathering state","iceGatheringState"),n+=this.generateFromPCState("ICE Connection state","iceConnectionState"),n+=this.generateFromPCState("Connection state","connectionState"),n+="</table>",n+='<style>\n        .webrtc-analyzer {\n            position: fixed;\n            width: 0px;\n            height: 0px;\n            top: 0px;\n            left: 0px;\n            z-index: 99999999;\n            font-family: monaco, Consolas, "Lucida Console", monospace;\n            font-size: 12px;\n        }\n        .webrtc-analyzer.hidden .box {\n            left: 100%;\n        }\n        .webrtc-analyzer .box {\n            position: fixed;\n            z-index: 1;\n            box-shadow: rgba(0, 0, 0, 0.3) 0px 0px 4px;\n            background: white;\n            left: 70%;\n            top: 0px;\n            width: 30%;\n            height: 100%;\n            transition: left 0.2s ease-out, top 0.2s ease-out, width 0.2s ease-out, height 0.2s ease-out;\n        }\n        .webrtc-analyzer main {\n            width: 100%;\n            height: 100%;\n            overflow: auto;\n            background-color: #1e1f22;\n        }\n\n        .webrtc-analyzer table {\n            width: 100%;\n            table-layout: fixed;\n            border-collapse:collapse;\n        }\n\n        .webrtc-analyzer tr:nth-child(2n) {\n            background-color:#282a2d; \n            color: rgb(224, 224, 224);\n        }\n        \n        .webrtc-analyzer td {\n            padding: 3px 10px;\n            word-wrap: break-word;\n        }\n        \n        .webrtc-analyzer tr:nth-child(2n+1){\n            color: rgb(129, 162, 190)\n        }\n        \n        .webrtc-analyzer tr td:nth-child(2) {\n            color: rgb(181, 189, 104);\n        }\n\n        .webrtc-analyzer header {\n            color: #fff;\n            font-size: 14px;\n            padding: 10px 20px;\n            background-color: #383b40;\n            margin-bottom: 6px;\n        }\n    </style>',n+="</main></div></div>",this.renderToStage(n),document.querySelector(`body #${this.id} .webrtc-analyzer main`).scrollTop=r}setKeyHandler(){document.addEventListener("keydown",this.handleKeyDown)}toggleVisibility(){this.isVisible?document.querySelector(`body #${this.id} .webrtc-analyzer`).classList.add("hidden"):document.querySelector(`body #${this.id} .webrtc-analyzer`).classList.remove("hidden"),this.isVisible=!this.isVisible}handleKeyDown(e){this.wasCTRL&&72===e.keyCode&&this.toggleVisibility(),17===e.keyCode?this.wasCTRL=!0:this.wasCTRL=!1}destroy(){document.removeEventListener("keydown",this.handleKeyDown),this.interval&&clearInterval(this.interval),this.clearStage()}}}])},function(e,t,r){"use strict";r.r(t);var n=r(2),a=ReactRouter.Route,i=ReactRouter.Router,o=(ReactRouter.Redirect,ReactRouter.IndexRoute),s=(ReactRouter.DefaultRoute,ReactRouter.RouteHandler,ReactRouter.Link),c=ReactDOM.render;const d=React.createClass({displayName:"Menu",render(){let e=this.props.activePage,t=function(t){return t==e?"active":""};return React.createElement("ul",null,React.createElement("li",{className:t("index")},React.createElement(s,{to:"/index"},"Home")),React.createElement("li",{className:t("lessons")},React.createElement(s,{to:"/lessons"},"Lessons")),React.createElement("li",{className:t("about")},React.createElement(s,{to:"/about"},"About")),React.createElement("li",{className:t("contact")},React.createElement(s,{to:"/contact"},"Contact")))}}),l=React.createClass({displayName:"App",getInitialState:function(){return{activePage:this.getCurrentPage()}},getCurrentPage:function(){let e=window.location.hash.substr(1);return-1!==e.indexOf("index")?e="index":-1!==e.indexOf("about")?e="about":-1!==e.indexOf("lessons")?e="lessons":-1!==e.indexOf("contact")&&(e="contact"),e},componentDidMount:function(){window.addEventListener("hashchange",()=>{this.setPage(this.getCurrentPage())})},setPage:function(e){this.setState({activePage:e})},render(){return React.createElement("div",{className:"contain"},React.createElement("header",null,React.createElement("div",{className:"wrap-container"},React.createElement("img",{src:"/img/webrtc.png",className:"webrtc-logo"}),React.createElement("span",{className:"bold"},"Teach"),React.createElement("span",{className:"normal"},"WebRTC"),React.createElement("nav",null,React.createElement("ul",null,React.createElement(d,{activePage:this.state.activePage}))))),React.createElement("main",null,this.props.children),React.createElement("div",{className:"about"},React.createElement("ul",null,React.createElement("li",null,React.createElement("h3",null,"Who am I?"),React.createElement("p",null,"My name is Gabriel Miko. I studied Web-Programming & Software Engineering in Budapest Hungary. I currently work for DoclerSSC Ltd.")),React.createElement("li",null,React.createElement("h3",null,"What I do?"),React.createElement("p",null,"I am Front-end Developer, I love the Web and I belive, this is the platform of the present & future. Beeing a Mozilla Tech Speaker gives me the power to teach & speak about what I like the most.")),React.createElement("li",null,React.createElement("h3",null,"Why WebRTC?"),React.createElement("p",null,"I have been interested in real time communication for last years. I am amazed by the opportunities given by the technology. Connecting people has been considered as the right business.")))),React.createElement("footer",null,React.createElement("div",{className:"wrap-container"},React.createElement("div",{className:"copy"}," TeachWebRTC - Gabriel Miko Licensed under Creative Commons."),React.createElement("nav",null,React.createElement("ul",null,React.createElement("li",null,React.createElement("a",null,"Contact")),React.createElement("li",null,React.createElement("a",null,"Twitter")),React.createElement("li",null,React.createElement("a",null,"Facebook")),React.createElement("li",{className:"active"},React.createElement("a",null,"Home")))))))}}),p=React.createClass({displayName:"Index",render:()=>React.createElement("main",null,React.createElement("div",{className:"wrap-container"},React.createElement("div",{className:"shout-out"},React.createElement("h2",null,"Woot, the first step is now done"),React.createElement("p",null,"Please note, this website is heavily under construction. Thank you for visiting. Live examples will help you understanding different parts of the WebRTC.Please be patient, new lessons are coming soon.",React.createElement("br",null),React.createElement("br",null),React.createElement(s,{to:"/lessons",className:"button"},"Jump to view the lessons")))))}),u=React.createClass({displayName:"NoMatch",render:()=>React.createElement("main",null,React.createElement("div",{className:"wrap-container"},React.createElement("div",{className:"shout-out"},React.createElement("h2",null,"Not Found"),React.createElement("p",null,"The page was not found!",React.createElement("br",null),React.createElement("br",null),React.createElement(s,{to:"/index",className:"button"},"Home")))))}),m=React.createClass({displayName:"GetUserMedia",componentDidMount:function(){initGetUserMediaDemo()},render:()=>React.createElement("main",{className:"gmu-demo"},React.createElement("div",{className:"wrap-container"},React.createElement("div",{className:"shout-out"},React.createElement("h2",null,"GetUserMedia"),React.createElement("div",null,React.createElement("video",{autoPlay:"true"})),React.createElement("p",null,"Thank you for visiting. Live examples will help you understanding different parts of the WebRTC.Please be patient, new lessons are coming soon.",React.createElement("br",null),React.createElement("br",null),React.createElement(s,{to:"/lessons/get-user-media",className:"button capture"},"Start capture"),React.createElement(s,{to:"/lessons/get-user-media",className:"button size"},"Toggle Video Size")))))}),f=React.createClass({displayName:"Lessons",render:()=>React.createElement("main",null,React.createElement("div",{className:"wrap-container"},React.createElement("div",{className:"shout-out"},React.createElement("h2",null,"1. WebRTC from ",React.createElement("span",{className:"bold"},"ZERO")," to"," ",React.createElement("span",{className:"bold"},"HERO")),React.createElement("p",null,"This tutorial covers the complete WebRTC flow.",React.createElement("br",null),React.createElement("br",null),React.createElement(s,{to:"/lessons/step-by-step-webrtc",className:"button"},"I want to be HERO"))),React.createElement("div",{className:"shout-out"},React.createElement("h2",null,"2. GetUserMedia"),React.createElement("p",null,"This is a simple getUserMedia demo without code.",React.createElement("br",null),React.createElement("br",null),React.createElement(s,{to:"/lessons/get-user-media",className:"button"},"See the demo")))))}),h=React.createClass({displayName:"LessonStepByStep",componentDidMount:function(){Object(n.initStepByStep)()},render:()=>React.createElement("div",null,React.createElement("div",{className:"wrap-container"},React.createElement("div",{className:"video grid-container"},React.createElement("div",{className:"grid-40"},React.createElement("h3",null,"My video"),React.createElement("video",{autoPlay:!0,controls:!0,className:"myvideo",playsInline:!0,muted:!0})),React.createElement("div",{className:"grid-20"},""),React.createElement("div",{className:"grid-40"},React.createElement("h3",null,"My remote video"),React.createElement("video",{autoPlay:!0,controls:!0,className:"yourvideo",playsInline:!0,muted:!0}))),React.createElement("div",{className:"tutorial"},React.createElement("div",{className:"step grid-container"},React.createElement("div",{className:"grid-40 part main"},"getUserMedia"),React.createElement("div",{className:"grid-20"},React.createElement("button",{className:"do-it","data-step":"1"},"DO IT!")),React.createElement("div",{className:"grid-40 result"},React.createElement("div",{className:"description"},"Obtaining the control under hardware. Asking for permission. Creating media object."),React.createElement("code",null,"mediaPromise = navigator.mediaDevices.getUserMedia({video: true, audio:true});","mediaPromise.then(function(mediaStream){","myVideoElement.srcObject = mediaStream;"),React.createElement("div",{className:"log","data-log":"1"}))),React.createElement("div",{className:"step grid-container"},React.createElement("div",{className:"grid-40"},React.createElement("div",{className:"part main"},"Create peer connection"),React.createElement("textarea",{className:"mycandidate",defaultValue:"Waiting for ICE Candidates."}),React.createElement("textarea",{className:"yourcandidate",defaultValue:"Waiting for ICE Candidates."})),React.createElement("div",{className:"grid-20"},React.createElement("button",{className:"do-it","data-step":"2"},"DO IT!")),React.createElement("div",{className:"grid-40 result"},React.createElement("div",{className:"description"},"Defining the PeerConnection configuration"),React.createElement("code",null,'const rtcOptions = {iceServers: [{urls: "stun:23.21.150.121"},{urls: "stun:stun.l.google.com:19302"}]}'),React.createElement("div",{className:"log","data-log":"2"}),React.createElement("div",{className:"description"},"Creating PeerConnection instance"),React.createElement("code",null,"const pc = new RTCPeerConnection(rtcOptions)"),React.createElement("div",{className:"log","data-log":"4"}),React.createElement("div",{className:"hr"}),React.createElement("div",{className:"description"},"Set the ICE Candidate listener"),React.createElement("code",null,"pc.onicecandidate = function(event) {"),React.createElement("div",{className:"log","data-log":"5"},"Candidates 0"),React.createElement("div",{className:"hr"}),React.createElement("div",{className:"description"},"Set the Remote Stream listener"),React.createElement("code",null,"pc.onTrack = function(event) {",React.createElement("br",null),"remoteVideoElement.srcObject = event.streams[0]"),React.createElement("div",{className:"log","data-log":"6"}))),React.createElement("div",{className:"step grid-container"},React.createElement("div",{className:"grid-40 part main"},"Attach media stream to Peer connection"),React.createElement("div",{className:"grid-20"},React.createElement("button",{className:"do-it","data-step":"3"},"DO IT!")),React.createElement("div",{className:"grid-40 result"},React.createElement("div",{className:"description"},"Calling addSteam function"),React.createElement("code",null,"pc.addStream(localMediaStream)"),React.createElement("div",{className:"log","data-log":"7"}))),React.createElement("div",{className:"step grid-container"},React.createElement("div",{className:"grid-40"},React.createElement("div",{className:"part mine"},"Create SDP Offer"),React.createElement("textarea",{className:"mysdp",defaultValue:"Waiting for my session description."})),React.createElement("div",{className:"grid-20"},React.createElement("button",{className:"do-it","data-step":"4"},"DO IT!")),React.createElement("div",{className:"grid-40 result"},React.createElement("div",{className:"description"},"Setting up offer contraints"),React.createElement("code",null,"constraints = {offerToReceiveAudio: true, offerToReceiveVideo: true}"),React.createElement("div",{className:"log","data-log":"8"}),React.createElement("div",{className:"hr"}),React.createElement("div",{className:"description"},"Create my offer"),React.createElement("code",null,"pc.createOffer(constraints).then(successFn, failureFn)"),React.createElement("div",{className:"log","data-log":"9"}),React.createElement("div",{className:"hr"}),React.createElement("div",{className:"description"},"Setting local description"),React.createElement("code",null,"pc.setLocalDescription(sdp, successFn, failureFn);"),React.createElement("div",{className:"log","data-log":"10"}))),React.createElement("div",{className:"step grid-container"},React.createElement("div",{className:"grid-40"},React.createElement("div",{className:"part mine"},"Send the SDP Offer")),React.createElement("div",{className:"grid-20"},React.createElement("button",{className:"do-it","data-step":"5"},"DO IT!")),React.createElement("div",{className:"grid-40 result"},React.createElement("div",{className:"description"},"Sending SDP offer"),React.createElement("code",null,"Various solutions for signaling."),React.createElement("div",{className:"log","data-log":"11"}))),React.createElement("div",{className:"step grid-container"},React.createElement("div",{className:"grid-40"},React.createElement("div",{className:"part yours"},"Receive SDP Offer (on remote)")),React.createElement("div",{className:"grid-20"},React.createElement("button",{className:"do-it","data-step":"6"},"DO IT!")),React.createElement("div",{className:"grid-40 result"},React.createElement("div",{className:"description"},"Creating a session description from the offer SDP"),React.createElement("code",null,"remoteSessionDescription = new RTCSessionDescription(remoteSDP)"),React.createElement("div",{className:"log","data-log":"12"}))),React.createElement("div",{className:"step grid-container"},React.createElement("div",{className:"grid-40"},React.createElement("div",{className:"part yours"},"Set remote description (on remote)")),React.createElement("div",{className:"grid-20"},React.createElement("button",{className:"do-it","data-step":"7"},"DO IT!")),React.createElement("div",{className:"grid-40 result"},React.createElement("div",{className:"description"},"Set my description as remote description (on remote)"),React.createElement("code",null,"pc.setRemoteDescription(remoteSessionDescription).then(successFn, failureFn)"),React.createElement("div",{className:"log","data-log":"13"}))),React.createElement("div",{className:"step grid-container"},React.createElement("div",{className:"grid-40"},React.createElement("div",{className:"part main"},"Send ICE Candidates")),React.createElement("div",{className:"grid-20"},React.createElement("button",{className:"do-it","data-step":"13"},"DO IT!")),React.createElement("div",{className:"grid-40 result"},React.createElement("div",{className:"description"},"Send ICE Candidates"),React.createElement("code",null,"Various solutions for signaling."),React.createElement("div",{className:"log","data-log":"14"}))),React.createElement("div",{className:"step grid-container"},React.createElement("div",{className:"grid-40"},React.createElement("div",{className:"part yours"},"Receive ICE candidates (on remote)")),React.createElement("div",{className:"grid-20"},React.createElement("button",{className:"do-it","data-step":"15"},"DO IT!")),React.createElement("div",{className:"grid-40 result"},React.createElement("div",{className:"description"},"Recieve ICE candidates"),React.createElement("code",null,"iceCandidate = new RTCIceCandidate({candidate: ice.candidate});"),React.createElement("div",{className:"log","data-log":"15"}),React.createElement("div",{className:"hr"}),React.createElement("div",{className:"description"},"Add candidates"),React.createElement("code",null,"pc.addIceCandidate(iceCandidate).then(successFn, failureFn)"),React.createElement("div",{className:"log","data-log":"16"}))),React.createElement("div",{className:"step grid-container"},React.createElement("div",{className:"grid-40"},React.createElement("div",{className:"part yours"},"Create answer SDP (on remote)"),React.createElement("textarea",{className:"yoursdp",defaultValue:"Waiting for your session description."})),React.createElement("div",{className:"grid-20"},React.createElement("button",{className:"do-it","data-step":"8"},"DO IT!")),React.createElement("div",{className:"grid-40 result"},React.createElement("div",{className:"description"},"Creating answer for the offer"),React.createElement("code",null,"pc.createAnswer().then(successFn, failureFn)"),React.createElement("div",{className:"log","data-log":"18"}))),React.createElement("div",{className:"step grid-container"},React.createElement("div",{className:"grid-40"},React.createElement("div",{className:"part yours"},"Set answer SDP (on remote)")),React.createElement("div",{className:"grid-20"},React.createElement("button",{className:"do-it","data-step":"9"},"DO IT!")),React.createElement("div",{className:"grid-40 result"},React.createElement("div",{className:"description"},"Setting answer as your local description"),React.createElement("code",null,"pc.setLocalDescription(anwerSDP).then(successFn, failureFn)"),React.createElement("div",{className:"log","data-log":"19"}))),React.createElement("div",{className:"step grid-container"},React.createElement("div",{className:"grid-40"},React.createElement("div",{className:"part yours"},"Send SDP back to local (on remote)")),React.createElement("div",{className:"grid-20"},React.createElement("button",{className:"do-it","data-step":"10"},"DO IT!")),React.createElement("div",{className:"grid-40 result"},React.createElement("div",{className:"description"},"Sending SPD back to local"),React.createElement("code",null,"Various solutions for signaling."),React.createElement("div",{className:"log","data-log":"20"}))),React.createElement("div",{className:"step grid-container"},React.createElement("div",{className:"grid-40"},React.createElement("div",{className:"part mine"},"Recieved answer SDP (on local)")),React.createElement("div",{className:"grid-20"},React.createElement("button",{className:"do-it","data-step":"11"},"DO IT!")),React.createElement("div",{className:"grid-40 result"},React.createElement("div",{className:"description"},"Creating a sesson description from the answer SDP"),React.createElement("code",null,"remoteSessionDescription = new RTCSessionDescription(remoteSDP)"),React.createElement("div",{className:"log","data-log":"21"}))),React.createElement("div",{className:"step grid-container"},React.createElement("div",{className:"grid-40"},React.createElement("div",{className:"part mine"},"Set remote description (on local)")),React.createElement("div",{className:"grid-20"},React.createElement("button",{className:"do-it","data-step":"12"},"DO IT!")),React.createElement("div",{className:"grid-40 result"},React.createElement("div",{className:"description"},"Setting your remote description"),React.createElement("code",null,"pc.setRemoteDescription(remoteSessionDescription).then(successFn, failureFn)"),React.createElement("div",{className:"log","data-log":"22"}))),React.createElement("div",{className:"step grid-container"},React.createElement("div",{className:"grid-40"},React.createElement("div",{className:"part main"},"Close the connection")),React.createElement("div",{className:"grid-20"},React.createElement("button",{className:"do-it","data-step":"17"},"DO IT!")),React.createElement("div",{className:"grid-40 result"},React.createElement("div",{className:"description"},"Close listener."),React.createElement("code",null,"pc.onclose = function () {"),React.createElement("div",{className:"log","data-log":"23"}),React.createElement("div",{className:"hr"}),React.createElement("div",{className:"description"},"Close the connection."),React.createElement("code",null,"stream.stop()"),React.createElement("div",{className:"log","data-log":"24"}))))))});c(React.createElement(i,null,React.createElement(a,{path:"/",component:l},React.createElement(o,{component:p}),React.createElement(a,{path:"index",component:p}),React.createElement(a,{path:"lessons",component:f}),React.createElement(a,{path:"/lessons/step-by-step-webrtc",component:h}),React.createElement(a,{path:"/lessons/get-user-media",component:m}),React.createElement(a,{path:"*",component:u}))),document.querySelector("#app")),t.default={}},function(e,t){},function(e,t,r){r(22),r(21),r(2),r(1)}])});